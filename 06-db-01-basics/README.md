# Домашнее задание к занятию "6.1. Типы и структура СУБД"

---
## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде

Документоориентированные БД (MongoDB). JSON-структуры логично и удобно хранить в документоориентированных БД, они работают без схемы, в них лекго добавлять json-документы разного размера и формата.

- Склады и автомобильные дороги для логистической компании

Графовые БД. Узлы - сущности базы данных, в них будем хранить информацию о складах. Ребра имеют начальный и конечные узлы, тип и направления, что очень удобно для описания дорог соединяющих склады.

- Генеалогические деревья

Иерархическая БД. Генеалогическое дерево по своей природе является иерархической структурой, как раз для хранения данных, имеющих такую структуру, была разработана иерархическая модель данных.

- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации

Базы данных Ключ-значение Redis, Memcashed. В архитектуре баз данных такого типа заложен удобный механизм кэширования данных, с возможностью включения TTL-механизма для хранимых элементов. 

- Отношения клиент-покупка для интернет-магазина

Реляционные БД. База данных интернет-магазина будет содержать такие сущности как: клиенты, заказы, товары, категории товаров, атрибуты товаров, корзины покупок и пр. Данные такого типа логично хранить в таблицах реляционных БД, а затем выстраивать между ними необходимые связи. Из мунусов такой реализации - медленный поиск по каталогам товаров при большом размере БД; сложность организации древовидного католога товаров; сложность масштабирования магазина.

Документо-ориентированные БД, например MongoDB. Удобно создавать, хранить и обрабатывать информацию о товарах с различными характеристиками, вся информация о товаре хранится в одном документе. Просто реализовать иерархическое представление хранимой в БД информации. Легко организовать быстрый поиск по каталогу товаров. 

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

---
## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):


- Данные записываются на все узлы с задержкой до часа (асинхронная запись)

*Как я понял описание системы, опираясь на мнение эксперта:* имеется распределенная СУБД, реплики которой стремятся к доступности, всегда готовы ответить на запрос, но при этом отказываются от согласованности, потому что синхронизируются очень медленно. Тогда решение такое:

CAP-теорема - AP. Хранящиеся в системе данные будут доступны и устойчивы к распаду сети, но в асинхронной системе не получится обеспечить свойство согласованности, поскольку процесс синхронизации данных занимает слишком много времени. 

PACELC-теорема - PA/EL(EC). При распаде сети наша система предпочтет ответить на запрос несогласованными данными, нежели промолчать (PA-система). Если база данных работает в штатном режиме она либо будет стремиться к срорости ответа (EL), либо к консистентности данных (EC).


*Другой вариант понимания задачи:* имеется строго-согласованная распределенная СУБД, реплики которой могут синхронизироваться очень медленно. В условии задачи не сказано как система должна реагировать на запросы адресованные несинхронизированным репликам. Она может просто отказаться выдавать в ответ несогласованные данные, потеряв свойство доступности. При такой трактовке условия задачи, решение такое:

CAP-теорема - CP. Строгая согласованность: при распаде сети, не отвечаем пока данные не будут синхронизированны.

PACELC-теорема - PC/EC. При распаде сети наша система предпочтет не ответить на запрос, нежели ответить несогласованными данными (PС). Если с сетью все в порядке, БД будет стремиться к срогой согласованности в ущерб времени ответа (EC).



- При сетевых сбоях, система может разделиться на 2 раздельных кластера

*Как я понял описание системы, опираясь на мнение эксперта:* имеется распределенная СУБД которая может разделиться на 2 кластера при распаде сети. Каждый отдельный кластер сможет отвечать на запросы пользователя, значит система будет доступной, но перестанет быть согласованной. Решение:

CAP-теорема - AP. Данная система потеряет свою согласованность при распаде сети, в случае которого система превратится в 2 доступных несогласованных кластера (AP).

PACELC-теорема - PA/EL(EC). При распаде сети система сохранит доступность, но потеряет согласованность (PA). Из условия задачи, это может быть: и система, гарантирующая строгую согласованность в ущерб времени ответа (EC); и "абсолютно" доступная система, которая будет стремиться дать максимально быстрый ответ (EL).



- Система может не прислать корректный ответ или сбросить соединение

*Как я понял описание системы, опираясь на мнение эксперта:* если наша система хоть как-то отвечает, пусть даже некорректно, она является доступной, а дает некорректный ответ, потому что хочет быть строго-согласованной; сбросить соединение она может, потому что неустойчива к распаду сети. Решение:

CAP-теорема - CA. Система стремится к строгой согласованности и максимально возможной доступности, но при сетевых сбоях может сбрасывать соединение, поэтому - неустойчива к распаду сети.

PACELC-теорема - PС/EС. При сетевом сбое система сохранит консистентность, просто перестав корректно отвечасть на запросы (PC). При штатной работе, скорее всего, система будет стремиться к абсолютной согласованности данных в ущерб скорости ответа (EC).


*Другой вариант понимания:* если наша система отвечает некорректно или сбрасывает соединение, значит она не может считаться доступной, но будет при этом согласованной. Решение:

CAP-теорема - CP. Скорее всего, в условии задачи описана ситуация выхода из строя части системы, при котором БД будет отвечать некорректным образом, значит она сохранит свою согласованность, но потеряет свойство доступности. Система не является доступной, поскольку может сбросить соединение или прислать некорректный ответ.

PACELC-теорема - PС/EС. При сетевом сбое система сохранит консистентность, просто перестав корректно отвечасть на запросы (PC). При штатной работе, скорее всего, система будет стремиться к абсолютной согласованности данных в ущерб скорости ответа (EC).

---
## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

Реализация любой распределенной БД - это всегда компромис между ACID и BASE. Полностью изолированные транзакции можно реализовать только в ACID-базе, но в распределенной среде такая БД не будет обладать свойством базовой доступности, присущей BASE-системам. Многие NoSQL БД отказываются от гарантии изоляции и предлагают «согласованность в конечном счёте» (eventual consistency), согласно которой мы в конце концов увидим действительные данные, но есть вероятность, что наш запрос прочитает недействительные значения – то есть, временные, или частично обновлённые, или устаревшие. Так же в BASE-системах сложно реализовать свойство полноценной стойкости (durability), поскольку для увеличения скорости многие BASE-СУБД осуществляют операции с данными в оперативной памяти и сбрасывают конечные состояния на диск с определенной переодичностью.

Если говорить категорично, то принципы ACID противоречать BASE-подходу и любая система, реализующая "базовую доступность" в распределенной среде, не сможет гарантировать строгую изоляцию и согласованность каждой проводимой пользователем транзакции.

---
## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?

Для реализации механизмов TTL и Pub/Sub будем использовать БД Redis

Минусы нашей системы:

- Опубликованные в Pub-канале значения могут быть потеряны. Если в момент публикации события подписчик будет неактивен, опубликованное сообщение удаляется из буфера издателя сразу после публикации, и подписчик не получит потенциально важное сообщение.
- Если на издателе публикуется очень много сообщений, подписчики могут не справиться с колличеством получаемых от издателя сообщений.
- Если издатель аварийно завершит свою работу, он потеряет всех своих подписчиков.
- Производительность Redis сильно зависит от количества доступной на хосте оперативной памяти, необходимо тщательно за этим следить.

---

